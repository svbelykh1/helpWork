Начиная с версии 1:9.0p1-1ubuntu1 openssh-serverв Kinetic Kudu (Ubuntu 22.10), OpenSSH в Ubuntu по умолчанию настроен на использование активации сокета systemd. Это означает, что sshd не будет запущен до тех пор, пока не будет получен входящий запрос на подключение. Это было сделано для уменьшения памяти, потребляемой экземплярами Ubuntu Server по умолчанию, что представляет особый интерес для Ubuntu, работающего в виртуальных машинах или контейнерах LXD: не запуская sshd, когда он не используется, мы экономим не менее 3 МБ памяти в каждом экземпляре, что составляет экономию примерно 5% на простаивающем, чистом кинетическом контейнере.

В Canonical мы заботимся о том, чтобы Ubuntu работала максимально эффективно на вашем оборудовании и в облаке, поэтому это изменение было внесено в рамках более масштабных усилий по сокращению объема памяти, используемого нашими образами по умолчанию. Стандартный образ Ubuntu 22.04 LXD на момент выпуска использовал 65 МБ ОЗУ, который в кинетической версии теперь использует 58 МБ после этого изменения OpenSSH; и ведутся дальнейшие улучшения с целью обратного переноса более безопасных изменений в наши образы Ubuntu 22.04 для улучшения использования памяти для наибольшего числа пользователей.

В новых установках Ubuntu 22.10 и более поздних версий изменение поведения OpenSSH должно быть полностью прозрачным для пользователей.

В Ubuntu 22.10, Ubuntu 23.04 и Ubuntu 23.10 при обновлении пользователи, у которых были настроены Portпараметры или ListenAddressпараметр в , /etc/ssh/sshd_configобнаружат, что эти параметры были перенесены в . (В качестве исключения, если объявлено /etc/systemd/system/ssh.socket.d/addresses.confболее одного параметра, конфигурация не переносится, поскольку у systemd другая семантика: любой настроенный адрес, отсутствующий во время загрузки, приведет к тому, что устройство не запустится. Поскольку во время обновления невозможно достоверно определить, может ли произойти сбой запуска при перезагрузке, если у вас настроено более одного параметра , ваша система не будет переведена на активацию на основе сокетов, а вместо этого демон будет запущен при загрузке, как и раньше.)ListenAddressListenStreamssh.socketssh.socketListenAddress

В Ubuntu 24.04 LTS эти настройки больше не переносятся, но настройки порта и адреса извлекаются динамически через sshd.confгенератор systemd.

Рекомендуется использовать активацию сокетов везде, где это возможно, но если по какой-либо причине после миграции вы обнаружите, что это несовместимо с вашей конфигурацией, все равно можно вернуться к предыдущему поведению без активации сокетов, выполнив:

systemctl disable --now ssh.socket
rm -f /etc/systemd/system/ssh.service.d/00-socket.conf
rm -f /etc/systemd/system/ssh.socket.d/addresses.conf
systemctl daemon-reload
systemctl enable --now ssh.service

sshd - server

ssh - client

конфиги, если выключили ssh.socket  тут - /etc/ssh/sshd_config   /etc/ssh/ssh_config ... иначе их нужно искать в другом месте.. где то тут -  /etc/systemd/system

статус служб ссх - systemctl status ssh
добавить в автозагрузку - sudo systemctl enable ssh  
убрать из автозагрузки - disable

включить\выключить - systemctl ssh start\stop



